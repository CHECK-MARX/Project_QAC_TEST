
#ifndef __QAC_INCLUDE_compare__
#define __QAC_INCLUDE_compare__

#if defined (__cpp_impl_three_way_comparison)

namespace std
{
  namespace __qacpp_detail
  {
    using type = signed char;
    enum class Ord : type
    {
      equivalent = 0,
      less = -1,
      greater = 1
    };
    enum class Ncmp : type
    {
      unordered = 2
    };

    struct unspec
    {
      constexpr unspec ( unspec * ) noexcept {}
    };
  }

  class partial_ordering
  {
  private:
    __qacpp_detail::type v;

    friend class weak_ordering;
    friend class strong_ordering;

    constexpr explicit partial_ordering ( __qacpp_detail::Ord v ) noexcept
      : v ( __qacpp_detail::type ( v ) )
    {
    }

    constexpr explicit partial_ordering ( __qacpp_detail::Ncmp v ) noexcept
      : v ( __qacpp_detail::type ( v ) )
    {
    }

  public:
    static const partial_ordering less;
    static const partial_ordering equivalent;
    static const partial_ordering greater;
    static const partial_ordering unordered;

    // comparisons
    friend constexpr bool operator== ( partial_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v == 0;
    }

    friend constexpr bool operator== ( partial_ordering lhs, partial_ordering rhs ) noexcept = default;

    friend constexpr bool operator<( partial_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v == -1;
    }

    friend constexpr bool operator> ( partial_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v == 1;
    }

    friend constexpr bool operator<= ( partial_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v <= 0;
    }

    friend constexpr bool operator>= ( partial_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return __qacpp_detail::type ( lhs.v & 1 ) == lhs.v;
    }

    friend constexpr bool operator<( __qacpp_detail::unspec, partial_ordering rhs ) noexcept
    {
      return rhs.v == 1;
    }

    friend constexpr bool operator> ( __qacpp_detail::unspec, partial_ordering rhs ) noexcept
    {
      return rhs.v == -1;
    }

    friend constexpr bool operator<= ( __qacpp_detail::unspec, partial_ordering rhs ) noexcept
    {
      return __qacpp_detail::type ( rhs.v & 1 ) == rhs.v;
    }

    friend constexpr bool operator>= ( __qacpp_detail::unspec, partial_ordering rhs ) noexcept
    {
      return 0 >= rhs.v;
    }

    friend constexpr partial_ordering operator<=> ( partial_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs;
    }

    friend constexpr partial_ordering operator<=> ( __qacpp_detail::unspec, partial_ordering rhs ) noexcept
    {
      if ( rhs.v & 1 )
        return partial_ordering ( __qacpp_detail::Ord ( -rhs.v ) );
      else
        return rhs;
    }
  };

  inline constexpr partial_ordering partial_ordering::less (__qacpp_detail::Ord::less);
  inline constexpr partial_ordering partial_ordering::equivalent (__qacpp_detail::Ord::equivalent);
  inline constexpr partial_ordering partial_ordering::greater (__qacpp_detail::Ord::greater);

  inline constexpr partial_ordering partial_ordering::unordered (__qacpp_detail::Ncmp::unordered);


  class weak_ordering
  {
  private:
    __qacpp_detail::type v;

    constexpr explicit weak_ordering ( __qacpp_detail::Ord v ) noexcept
      : v ( __qacpp_detail::type ( v ) )
    {
    }

    friend class strong_ordering;

  public:
    // valid values
    static const weak_ordering less;
    static const weak_ordering equivalent;
    static const weak_ordering greater;

    constexpr operator partial_ordering ( ) const noexcept
    {
      return partial_ordering ( __qacpp_detail::Ord ( v ) );
    }

    // comparisons
    friend constexpr bool operator== ( weak_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v == 0;
    }

    friend constexpr bool operator== ( weak_ordering lhs, weak_ordering rhs ) noexcept = default;

    friend constexpr bool operator<( weak_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v < 0;
    }

    friend constexpr bool operator> ( weak_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v > 0;
    }

    friend constexpr bool operator<= ( weak_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v <= 0;
    }

    friend constexpr bool operator>= ( weak_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v >= 0;
    }

    friend constexpr bool operator<( __qacpp_detail::unspec, weak_ordering rhs ) noexcept
    {
      return 0 < rhs.v;
    }

    friend constexpr bool operator> ( __qacpp_detail::unspec, weak_ordering rhs ) noexcept
    {
      return 0 > rhs.v;
    }

    friend constexpr bool operator<= ( __qacpp_detail::unspec, weak_ordering rhs ) noexcept
    {
      return 0 <= rhs.v;
    }

    friend constexpr bool operator>= ( __qacpp_detail::unspec, weak_ordering rhs ) noexcept
    {
      return 0 >= rhs.v;
    }

    friend constexpr weak_ordering operator<=> ( weak_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs;
    }

    friend constexpr weak_ordering operator<=> ( __qacpp_detail::unspec, weak_ordering rhs ) noexcept
    {
      return weak_ordering ( __qacpp_detail::Ord ( -rhs.v ) );
    }
  };

  inline constexpr weak_ordering weak_ordering::less (__qacpp_detail::Ord::less);
  inline constexpr weak_ordering weak_ordering::equivalent (__qacpp_detail::Ord::equivalent);
  inline constexpr weak_ordering weak_ordering::greater (__qacpp_detail::Ord::greater);

  class strong_ordering
  {
  private:
    __qacpp_detail::type v;
    constexpr explicit strong_ordering ( __qacpp_detail::Ord v ) noexcept
      : v ( __qacpp_detail::type ( v ) )
    {
    }

    friend class partial_ordering;
    friend class weak_ordering;

  public:
    static const strong_ordering less;
    static const strong_ordering equal;
    static const strong_ordering equivalent;
    static const strong_ordering greater;

    constexpr operator partial_ordering ( ) const noexcept
    {
      return partial_ordering ( __qacpp_detail::Ord ( v ) );
    }

    constexpr operator weak_ordering ( ) const noexcept
    {
      return weak_ordering ( __qacpp_detail::Ord ( v ) );
    }

    // comparisons
    friend constexpr bool operator== ( strong_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v == 0;
    }

    friend constexpr bool operator== ( strong_ordering lhs, strong_ordering rhs) noexcept = default;

    friend constexpr bool operator<( strong_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v < 0;
    }

    friend constexpr bool operator> ( strong_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v > 0;
    }

    friend constexpr bool operator<= ( strong_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v <= 0;
    }

    friend constexpr bool operator>= ( strong_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs.v >= 0;
    }

    friend constexpr bool operator<( __qacpp_detail::unspec, strong_ordering rhs ) noexcept
    {
      return 0 < rhs.v;
    }

    friend constexpr bool operator> ( __qacpp_detail::unspec, strong_ordering rhs ) noexcept
    {
      return 0 > rhs.v;
    }

    friend constexpr bool operator<= ( __qacpp_detail::unspec, strong_ordering rhs ) noexcept
    {
      return 0 <= rhs.v;
    }

    friend constexpr bool operator>= ( __qacpp_detail::unspec, strong_ordering rhs ) noexcept
    {
      return 0 >= rhs.v;
    }

    friend constexpr strong_ordering operator<=> ( strong_ordering lhs, __qacpp_detail::unspec ) noexcept
    {
      return lhs;
    }

    friend constexpr strong_ordering operator<=> ( __qacpp_detail::unspec, strong_ordering rhs ) noexcept
    {
      return strong_ordering ( __qacpp_detail::Ord ( -rhs.v ) );
    }
  };

  inline constexpr strong_ordering strong_ordering::less (__qacpp_detail::Ord::less);
  inline constexpr strong_ordering strong_ordering::equal (__qacpp_detail::Ord::equivalent);
  inline constexpr strong_ordering strong_ordering::equivalent (__qacpp_detail::Ord::equivalent);
  inline constexpr strong_ordering strong_ordering::greater (__qacpp_detail::Ord::greater);

}

#endif  // __cpp_impl_three_way_comparison

#endif
